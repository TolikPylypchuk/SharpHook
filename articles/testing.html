<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Testing | SharpHook </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Testing | SharpHook ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/TolikPylypchuk/SharpHook/blob/v6.2.0/docs/articles/testing.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../logo.png" alt="SharpHook">
            SharpHook
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="testing">Testing</h1>

<p>SharpHook provides two classes which make testing easier. They aren't required since mocks can be used instead, but
unlike mocks, no setup is required to use these classes, and they respect the invariants of their real counterparts.</p>
<div class="NOTE">
<h5>Note</h5>
<p>Testing classes are contained directly in the <code>SharpHook</code> package. This increases the package size, but these classes
will be removed if trimming is enabled.</p>
</div>
<h2 id="test-global-hook">Test Global Hook</h2>
<p><code>SharpHook.Testing.TestGlobalHook</code> provides an implementation of <code>IGlobalHook</code> and <code>IEventSimulator</code> which can be used
for testing. When the <code>Run</code> or <code>RunAsync</code> method is called, it will dispatch events using the various <code>Simulate</code> methods
from <code>IEventSimulator</code>.</p>
<p>Here's a very simple example of a test which utilizes <code>TestGlobalHook</code>:</p>
<pre><code class="lang-c#">[Fact]
public async Task TestLastPressedKey()
{
    var hook = new TestGlobalHook();
    var keyCode = KeyCode.VcA;
    var componentUnderTest = new SomeClassWhichUsesGlobalHookEvents(hook);

    // Run the test hook asynchronously and ignore the result
    var hookStopped = hook.RunAsync();

    hook.SimulateKeyPress(keyCode);

    hook.Dispose();
    await hookStopped;

    Assert.Equal(keyCode, componentUnderTest.LastPressedKey);
}
</code></pre>
<p>If this class is used as an <code>IEventSimulator</code> in the tested code, then the <code>SimulatedEvents</code> property can be checked to
see which events were simulated using the test instance.</p>
<p><code>TestGlobalHook</code> can be used with two different threading modes – the simple mode and the event loop mode.</p>
<p>When running in simple mode (the default mode) the hook will dispatch events immediately in the same thread which
simulates them.</p>
<p>When running the event loop, the hook will run an actual even loop on the thread on which <code>Run</code> was called. When
simulating events, they will be posted to the event loop, and then dispatched in the hook thread. This mode is much more
difficult to use correctly, so it is useful only when it is important for event handlers to run in the same thread on
which the hook itself is running. It's recommended to stop the global hook and wait for it to stop before asserting any
events. Since these actions are done in different threads, it is not guaranteed that an event will be dispatched
immediately after it is simulated. <code>Run</code> and the task returned by <code>RunAsync</code> will complete after every event has been
dispatched.</p>
<p>Other than that, members of <code>TestGlobalHook</code> are quite straightforward; the API reference should be viewed for more
info.</p>
<p>If an <code>IReactiveGlobalHook</code> is needed for testing, then <code>ReactiveGlobalHookAdapter</code> can be used to adapt an instance of
<code>TestGlobalHook</code>.</p>
<h2 id="test-low-level-functionality-provider">Test Low-Level Functionality Provider</h2>
<p>If the low-level functionality of SharpHook should be mocked, or mocking should be pushed as far away as possible,
then <code>SharpHook.Testing.TestProvider</code> can be used. It implements every interface in the <code>SharpHook.Providers</code> namespace,
and as such, it can be used instead of normal low-level functionality providers.</p>
<p>Like <code>TestProvider</code>, this class can post events using the <code>PostEvent</code> method and dispatch them if <code>Run</code> has been
called. It also contains the <code>PostedEvents</code> property.</p>
<p><code>TestProvider</code> can be used with two different threading modes – the simple mode and the event loop mode.</p>
<p>When running in simple mode (the default mode) the provider will dispatch events immediately in the same thread which
simulates them.</p>
<p>When running the event loop, the provider will run an actual even loop on the thread on which <code>Run</code> was called. When
simulating events, they will be posted to the event loop, and then dispatched in the hook thread. This mode is much more
difficult to use correctly, so it is useful only when it is important for event handlers to run in the same thread on
which the hook itself is running. It's recommended to stop the provider and wait for it to stop before asserting any
events. Since these actions are done in different threads, it is not guaranteed that an event will be dispatched
immediately after it is simulated. <code>Run</code> and the task returned by <code>RunAsync</code> will complete after every event has been
dispatched.</p>
<p>All classes in SharpHook use providers instead of directly using the <code>UioHook</code> class for low-level functionality.
The providers are selectable, so e.g., the following global hook can be used for testing:</p>
<pre><code class="lang-c#">var testProvider = new TestProvider();

// Calls to methods in testProvider will be reflected in the hook
var hook = new SimpleGlobalHook(globalHookProvider: testProvider);

// Calls to methods in testProvider will be reflected in the simulator
var simulator = new EventSimulator(simulationProvider: testProvider);
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p><code>TaskPoolGlobalHook</code> shouldn't be used this way since its event handlers are asynchronous and there is no built-in
way to know when they are actually executed. As such, it's difficult to check event handler results. If you want
to use a real hook, e.g. for integration testing, then use <code>SimpleGlobalHook</code> instead.</p>
</div>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/TolikPylypchuk/SharpHook/blob/v6.2.0/docs/articles/testing.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Created by <a href="https://tolik.io">Tolik Pylypchuk</a>. Docs made with <a href="https://dotnet.github.io/docfx">docfx</a></span>.
        </div>
      </div>
    </footer>
  </body>
</html>
