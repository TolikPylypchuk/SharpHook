<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Global Hooks </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Global Hooks ">
    <meta name="generator" content="docfx 2.59.4.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="global-hooks">Global Hooks</h1>

<h2 id="the-interface">The Interface</h2>
<p>SharpHook provides the <code>SharpHook.IGlobalHook</code> interface along with two default implementations which you can use
to control the hook and subscribe to its events. This way is preferred to using native functions since it's more
convenient. Here's a basic usage example:</p>
<pre><code class="lang-C#">using SharpHook;

// ...

var hook = new TaskPoolGlobalHook();

hook.HookEnabled += OnHookEnabled;     // EventHandler&lt;HookEventArgs&gt;
hook.HookDisabled += OnHookDisabled;   // EventHandler&lt;HookEventArgs&gt;

hook.KeyTyped += OnKeyTyped;           // EventHandler&lt;KeyboardHookEventArgs&gt;
hook.KeyPressed += OnKeyPressed;       // EventHandler&lt;KeyboardHookEventArgs&gt;
hook.KeyReleased += OnKeyReleased;     // EventHandler&lt;KeyboardHookEventArgs&gt;

hook.MouseClicked += OnMouseClicked;   // EventHandler&lt;MouseHookEventArgs&gt;
hook.MousePressed += OnMousePressed;   // EventHandler&lt;MouseHookEventArgs&gt;
hook.MouseReleased += OnMouseReleased; // EventHandler&lt;MouseHookEventArgs&gt;
hook.MouseMoved += OnMouseMoved;       // EventHandler&lt;MouseHookEventArgs&gt;
hook.MouseDragged += OnMouseDragged;   // EventHandler&lt;MouseHookEventArgs&gt;

hook.MouseWheel += OnMouseWheel;       // EventHandler&lt;MouseWheelHookEventArgs&gt;

hook.Run();
// or
await hook.RunAsync();
</code></pre>
<p><code>IGlobalHook</code> contains separate events for every event type that can be raised by libuiohook. The sender of these
events is the <code>IGlobalHook</code> itself.</p>
<p>It also contains the <code>Run</code> and <code>RunAsync</code> methods which, well, run the global hook. <code>Run</code> runs it on the current thread,
blocking it until the global hook is disposed. <code>RunAsync</code> runs the global hook in a non-blocking way and returns a
<code>Task</code> - this task is finished when the hook is destroyed. Since the underlying native API is blocking, the only way to
run the hook in a non-blocking way is to run it on a separate thread, and all default implementations do just that.</p>
<p>You can specify in the hook constructors whether <code>RunAsync</code> should create a background thread or not. Background threads
don't block the application from exiting if all other threads have finished executing. By default the created thread
will not be a background thread.</p>
<p>You can subscribe to events after the hook is started.</p>
<p>If you run the hook when it's already running, then an exception will be thrown. You can check whether a hook is running
using its <code>IsRunning</code> property.</p>
<p><code>IGlobalHook</code> extends <code>IDisposable</code>. When you call the <code>Dispose</code> method on a hook, it's destroyed. The contract of
the interface is that once a hook has been destroyed, it cannot be started again - you'll have to create a new instance.
Calling <code>Dispose</code> when the hook is not running is safe - it just won't do anything (other than marking the instance as
disposed). You can check whether the hook is disposed using the <code>IsDisposed</code> property.</p>
<p>Hook events are of type <code>HookEvent</code> or a derived type which contains more info. It's possible to suppress event
propagation by setting the <code>SuppressEvent</code> property to <code>true</code> inside the event handler. This must be done synchronously
and is only supported on Windows and macOS.</p>
<p><strong>Important</strong>: Always use one instance of <code>IGlobalHook</code> at a time in the entire application since they all must use
the same static method to set the hook callback for libuiohook, so there may only be one callback at a time.</p>
<h2 id="the-default-implementations">The Default Implementations</h2>
<p>SharpHook provides two implementations of <code>IGlobalHook</code>:</p>
<ul>
<li><p><code>SharpHook.SimpleGlobalHook</code> runs all of its event handlers on the same thread on which the hook itself runs. This
means that the handlers should generally be fast since they will block the hook from handling the events that follow if
they run for too long.</p>
</li>
<li><p><code>SharpHook.TaskPoolGlobalHook</code> runs all of its event handlers on other threads inside the default thread pool for
tasks. The parallelism level of the handlers can be configured. On backpressure it will queue the remaining handlers.
This means that the hook will be able to process all events. This implementation should be preferred to
<code>SimpleGlobalHook</code> except for very simple use-cases. But it has a downside - suppressing event propagation will be
ignored since event handlers are run on other threads.</p>
</li>
</ul>
<p>The library also provides the <code>SharpHook.GlobalHookBase</code> class which you can extend to create your own implementation
of the global hook. It calls the appropriate event handlers, and you only need to implement a strategy for dispatching
the events. It also contains a destructor which will stop the global hook if this object is not reachable anymore.</p>
<p>Next article: <a href="reactive.html">Reactive Global Hooks</a>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/TolikPylypchuk/SharpHook/blob/master/docs/articles/hooks.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
